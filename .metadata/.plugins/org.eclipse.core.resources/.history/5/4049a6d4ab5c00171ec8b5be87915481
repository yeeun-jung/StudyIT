<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<div id="redis_div">
	<table border="1" width="50%" height="300px">
		<tr>
			<td colspan="2" align="center">INPUT</td>
		</tr>
		<tr>
			<td width="50%" align="center">Key</td>
			<td align="center"><input type="text" id="key" size="35"></td>
		</tr>
		<tr>
			<td align="center">value</td>
			<td align="center"><input type="text" id="value" size="35"></td>
		</tr>
		<tr>
			<td align="center">Expire Time (sec)</td>
			<td align="center"><input type="text" id="expire" value="300" size="35"></td>
		</tr>
		<tr>
			<td colspan="2" align="right"><input type="button" value="입력" id="insert">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
		</tr>
	</table>
	<br>
	<br>
	<br>
	<br>
	<table border="1" width="50%" height="300px">
		<tr>
			<td colspan="2" align="center">OUTPUT</td>
		</tr>
		<tr>
			<td width="50%" align="center">Key</td>
			<td align="center"><input type="text" id="search_key" size="35"></td>
		</tr>
		<tr>
			<td colspan="2" align="right"><input type="button" value="검색" id="search">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
		</tr>
		<tr>
			<td align="center">value</td>
			<td align="center"><input type="text" id="search_value" size="35"></td>
		</tr>
	</table>
</div>
</body>
<script src="//code.jquery.com/jquery.min.js"></script>
<script language="javascript">
    var url="controller.php";

    $(document).ready(function(){
        $('#insert').click(function(){
            input();
        });

        $('#search').click(function(){
            output();
        });

        $("#value").keypress(function (e) {
            if (e.which == 13){
                input();
            }
        });

        $("#search_key").keypress(function (e) {
            if (e.which == 13){
                output();
            }
        });
    });





    function input(){
        var key = $('#key').val();
        var value = $('#value').val();
        var expire = $('#expire').val();

        if(!key){
            alert('key를 입력해주세요');
            $('#key').focus();
            return false;
        }
        if(!value){
            alert('value를 입력해주세요');
            $('#value').focus();
            return false;
        }
        if(!expire){
            alert('expire를 입력해주세요');
            $('#expire').focus();
            return false;
        }

        var params="mode=insert&key="+key+"&value="+value+"&expire="+expire;
        $.ajax({
            type:"POST",
            url:url,
            data:params,
            success:function(data){
                var result = $.parseJSON(data);
                if(result.result == 'ok'){
                    alert('입력완료');
                    $('#key').val('');
                    $('#value').val('');
                    $('#key').focus();
                }else if(result.result == 'redis fail'){
                    alert('[error-01] - 시스템 장애 입니다. 관리자에게 문의하세요');
                    $('#redis_div').hide();
                    return false;
                }else if(result.result == 'duplicate'){
                    alert('[error-02] - 중복되는 키가 존재합니다. 다시 입력해주세요.');
                    $('#key').val('');
                    $('#value').val('');
                    $('#key').focus();
                    return false;
                }else{
                    alert('[error-03] - 예기치 않은 문제가 발생했습니다. 다시 시도해 주세요.');
                    return false;
                }
            },
            error:function(e){
                alert(e.responseText);
            }
        });
    }

    function output(){
        var search_key = $('#search_key').val();

        if(!search_key){
            alert('검색 key를 입력해주세요');
            $('#search_key').focus();
            return false;
        }

        var params="mode=search&key="+search_key;
        $.ajax({
            type:"POST",
            url:url,
            data:params,
            success:function(data){
                var result = jQuery.parseJSON(data);
                if(result.result=='ok'){
                    $('#search_value').val(result.value);
                }else{
                    alert('[error-04] - 해당키가 존재하지 않습니다');
                    $('#search_key').focus();
                    return false;
                }
            },
            error:function(e){
                alert(e.responseText);
            }
        });
    }
</script>
</html>